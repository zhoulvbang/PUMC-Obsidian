#使用技巧 #Stata

# 命令介绍

Stata 中实现线性回归的主要命令是 `regress` ，其基本语法如下：

```stata
regress depvar [indep vars] [if] [in] [weight] [,options]
```

命令还包含很多选项，其中比较重要的几个是：

- `beta`：表示输出标准化回归系数，否则输出非标准化系数；
- `vce(robust)`：表示使用怀特异方差稳健标准误，否则使用常规标准误；
- `vce(cluster clustvar)`：表示针对变量 `clustvar` 计算聚类稳健标准误，否则使用常规标准误；
- `level(#)`：设置置信区间的置信度，默认为 95%，即 `level(95)`。

在使用 `regress` 命令的时候，有几个注意事项。

- 第一，自变量若为多分类变量，可以在变量名前通过 `i.` 自动生成虚拟变量纳入模型。
- 第二，若要在模型中纳人两个自变量的交互项，一个简便方法是用 `#` 将这两个变量相连，但需注意的是，如果其中有变量是连续变量，需要在变量名前加 `c.` ，否则 Stata 默认将之当作分类变量进行交互。
- 第三，用 `#` 将两个变量相连只能纳入两个变量的交互项，不能同时纳入主效应项；若要将主效应项也纳入，需要用 `##` 将变量连接起来。
- 第四，在执行 `regress` 之后，有很多附带命令可以使用，其中比较重要的一个是`predict`,使用该命令可以预测出模型的拟合值和残差等。

具体使用方法我们将在案例中进行介绍。

除了 `regress` 之外，在 Stata 中还可以通过命令 `teffects ra` 直接得到回归调整估计量，其基本语法如下：

```stata
teffects ra (ovar omvarlist [,omodel]) (tvar) [if] [in] [weight] [, options]
```

其中，
- `teffects ra` 是命令名，其后的第一个小括号用来设置结果方程;
- `ovar` 是结果方程的因变量;
- `omvarlist` 是协变量，即本章所说的需要在回归模型中加以统计控制的变量。在默认情况下，Stata 将使用线性回归拟合结果方程，但研究者也可以通过 `omodel` 设置其他估计方法，这取决于结果方程中因变量的类型。

本章仅考虑因变量是连续变量的情况，因此，将使用软件默认的线性回归法进行估计。

`teffects ra` 命令后的第二个小括号用来设置干预变量，`tvar` 是变量名，它必须是一个分类变量，通常是一个二分变量。该命令中 `if`、`in` 和 `weight` 与 `regress` 命令相同，此处不再介绍。在选项方面，比较重要的有：

- `ate`:估计 ATE,这是软件默认的输出结果；
- `atet`:估计 ATT；
- `pomeans`:估计潜在结果均值；
- `vce(robust)`:使用怀特异方差稳健标准误；
- `level(#)`:设置置信区间的置信度，默认为 95%，即 `level(95)`；
- `control()`:设置与控制组对应的干预变量的取值，默认以取值为0的那一类作为控制组；
- `tlevel()`:设置与干预组对应的干预变量的取值，默认以取值为1的那一类作为干预组；
- `aequations`:汇报辅助回归结果，即如下两个方程(4.19)和方程(4.20)的估计结果。

